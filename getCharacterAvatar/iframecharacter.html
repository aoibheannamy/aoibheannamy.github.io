<!DOCTYPE HTML>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Character Avatar Representation</title>
    <link href="https://unpkg.com/tabulator-tables@4.6.3/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.6.3/dist/js/tabulator.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.0.5/jspdf.plugin.autotable.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
    <script type="text/javascript" src="CharactersLabelledDetailsBest.json"></script>
</head>

<body>

    <!--Create iframe container -->
    <div class="embed-responsive embed-responsive-16by9"
        style="border: 1px solid rgba(0,0,0,.1); border-radius: 0.25rem; min-height: 400px;">
        <iframe id="myiframe" class="embed-responsive-item" src="" style="width: 100%; height: 400px;">
        </iframe>
    </div>


    <!--Create div for the tabulator table-->
    <div id="example-table" style="width: 90%; margin-bottom: 30px;"></div>
    <!--Create buttons for interactivity between table and iframe-->
    <button type="button" class="btn btn-info" id="generateAvatar" onclick="generateAvatar()">Generate Character
        Avatar!</button>
    <button type="button" class="btn btn-info" id="clearAvatar" onclick="clearAvatar()">Clear Character Avatar
        Selection!</button>


    <script type="text/javascript">
        //create table to hold the character appearances that were labelled via Amazon's mechanical Turk
        var local_data = charDetails;
        var rowIndex;
        console.log("table data: " + local_data);
        var table = new Tabulator("#example-table", {
            data: local_data,
            index: "numberOfCharacters",
            selectable: 1,
            pagination: "local",
            layout: "fitColumns",
            placeholder: "No Data Available",
            columns: [
                { title: "Character", field: "numberOfCharacters", editor: "input" },
                { title: "Name", field: "Names", editor: "input" },
                { title: "Gender", field: "gender", editor: "select", editorParams: { values: { "m": "Male", "f": "Female" } } },
                { title: "Complexion", field: "complexion", editor: "select", editorParams: { values: { "#FFDFC4": "#FFDFC4", "#F0D5BE": "#F0D5BE", "#EECEB3": "#EECEB3", "#E1B899": "#E1B899", "#E5C298": "#E5C298", "#FFDCB2": "#FFDCB2", "#E5B887": "#E5B887", "#E5A073": "#E5A073", "#E79E6D": "#E79E6D", "#DB9065": "#DB9065", "#CE967C": "#CE967C", "#C67856": "#C67856", "#BA6C49": "#BA6C49", "#A57257": "#A57257", "#F0C8C9": "#F0C8C9", "#DDA8A0": "#DDA8A0", "#B97C6D": "#B97C6D", "#A8756C": "#A8756C", "#AD6452": "#AD6452", "#5C3836": "#5C3836", "#CB8442": "#CB8442", "#BD723C": "#BD723C", "#704139": "#704139", "#A3866A": "#A3866A" } } },
                { title: "Eye Colour", field: "eyeColour", editor: "select", editorParams: { values: { "#008000": "Green", "#00FFFF": "Aqua", "#0000FF": "Blue", "#959292": "Grey", "#553933": "Brown", "#000000": "Black" } } },
                { title: "Hair Colour", field: "hairColour", editor: "select", editorParams: { values: { "#000000": "Black", "#D03210": "Red", "#553933": "Brown", "#bc8b37": "Blond(e)", "#959292": "Grey", "#FFFFFF": "White" } } },
                { title: "Hair Style", field: "hair", editor: "select", editorParams: { values: { "afro": "Afro (m/f)", "balding": "Balding (m)", "crewcut": "Crewcut (m)", "down": "Down (m/f)", "emo": "Emo (m/f)", "spider": "Spider (m/f)", "gelled": "Gelled (m)", "wavy": "Wavy (m)", "manga": "Manga (m/f)", "bangs": "Bangs(f)", "flowing": "Flowing(f)", "mohawk": "mohawk(f/m)", "pigtails": "Pigtails(f)", "ponytail": "Ponytail(f)", "short": "Short(f)", "short_slick": "Short slick(f)", "starlet": "Starlet(f)", "odango": "Odango(f)", "punky": "punky(f)", "wreckingball": "Wreckingball (f)" } } },
                { title: "Facial Hair", field: "facialHair", editor: "select", editorParams: { values: { "beard_boxed": "Beard-boxed", "beard_guru": "Beard-guru", "goatee": "Goatee", "moustache": "Moustache", "muttonchops": "Muttonchops" } } },
                { title: "Shirt", field: "shirt", editor: "select", editorParams: { values: { "colar": "Collar(m)", "tshirt": "T-shirt(m)", "sweat": "Sweatshirt(f)" } } },
                { title: "Blouse", field: "blouse", editor: "select", editorParams: { values: { "cherry": "Blouse" } } },
                { title: "Dress", field: "dress", editor: "select", editorParams: { values: { "accolade": "Accolade", "corset": "Corset", "suit": "Suit", "parisian_fall": "Parisian", "german_expression": "German" } } },
                { title: "Tie", field: "tie", editor: "select", editorParams: { values: { "neck": "Neck", "bow": "Bowtie" } } },
                { title: "Vest", field: "vest", editor: "select", editorParams: { values: { "vest": "Vest" } } },
                { title: "Jacket", field: "jacket", editor: "select", editorParams: { values: { "suit": "Suit(m)" } } },
                { title: "Trousers", field: "pants", editor: "select", editorParams: { values: { "suit": "Suit(m)", "jeans": "Jeans(m/f)" } } },
                { title: "Skirt", field: "skirt", editor: "select", editorParams: { values: { "a-line": "A-line", "draped": "Draped", "school": "Pleated" } } },
                { title: "Shoes", field: "shoes", editor: "select", editorParams: { values: { "hightops": "Hightops(m/f)", "highheels": "High heels", "leather": "Leather(m)" } } },
                {
                    title: "Distinctive Features", //create column group
                    columns: [
                        { title: "Glasses", field: "glasses", hozAlign: "right", editor: "select", editorParams: { values: { "hipster": "Hipster", "rayban": "RayBan", "wayrafer": "Wayfarer" } } },
                        { title: "Hat", field: "hat", hozAlign: "center", editor: "select", editorParams: { values: { "baseball": "Baseball(m/f)", "cap": "Cap", "cowboy": "Cowboy", "top": "Top hat", "police": "Police", "beach": "Beach(f)", "tiara": "Tiara(f)" } } },
                        { title: "Earrings", field: "earrings", hozAlign: "center", editor: "select", editorParams: { values: { "double-drop": "Drop(f)", "gold_rings": "Gold Rings(f/m)", "gold_ring_right": "Gold ring right(m)", "gold_ring_left": "Gold ring left(m)" } } },
                        { title: "Makeup", field: "makeup", hozAlign: "center", editor: "select", editorParams: { values: { "gothic_eyeliner": "Gothic eyeliner" } } },
                        { title: "Tattoos", field: "tattoos", hozAlign: "center", editor: "select", editorParams: { values: { "aum_chest": "Aum chest(m)", "aum_left": "Aum left(m)", "aum_right": "Aum right(m)", "chaos_chest": "Chaos chest", "chaos_left": "Chaos left", "chaos_right": "Chaos right", "archeopteryx_left": "Archeopteryx left(f)" } } },
                        { title: "Scars", field: "scars", hozAlign: "center", editor: "select", editorParams: { values: { "horizontal_neck": "Horizontal neck(m)", "horizontal_nose": "Horizontal nose(m)", "vertical_left": "Vertical left(m)", "vertical_right": "Vertical right(m)" } } },
                    ],
                },

            ],

            // this function accesses the row which has been selected, or clicked

            rowClick: function (e, row) {
                // get index of row selected
                rowIndex = row.getIndex();
                // print index to console
                console.log("Row index: " + rowIndex);
                // get data for the selected row
                var rowData = row.getData();
                // print row data to console
                console.log(rowData);

            }


        });

        table.replaceData(local_data);
        for (var loop = 1; loop < 10; loop++) {
            table.addRow({ numberOfCharacters: loop }, false);
        }

        document.getElementById("generateAvatar").onclick = function () { generateAvatar() };
        document.getElementById("clearAvatar").onclick = function () { clearAvatar() };

        /**
         * This function will, when the Generate Avatar button is clicked, reload the iframe to include the parameters 
        */
        function generateAvatar() {
            myTable = Tabulator.prototype.findTable('#example-table')[0];
            var data = myTable.getData();
            // get the parameters
            // split up row data into separate variables
            // the following variables should always have a value
            // need to add the prefixes before so that charactercreator.org can read them correctly!!
            // declare variables for row variables
            var rowGender, rowComplexion, rowEyeColour, rowHair, rowHairColour, rowFacialHair, rowShirt, rowBlouse, rowDress, rowJacket, rowSkirt, rowPants, rowTie, rowVest, rowShoes, rowMakeup, rowScars, rowTattoos, rowGlasses, rowHat, rowEarrings;
            rowGender = "sex=" + data[rowIndex].gender;
            rowComplexion = "skinColor=" + data[rowIndex].complexion;
            rowEyeColour = "irisColor=" + data[rowIndex].eyeColour;
            rowHair = "hair=" + data[rowIndex].hair;
            rowHairColour = "hairColor=" + data[rowIndex].hairColour;

            // these variables are optional, so need the check the value is not null before setting to the corresponding variable

            rowFacialHair = "facialhair=" + data[rowIndex].facialHair;
            rowShirt = "shirt=" + data[rowIndex].shirt;
            rowBlouse = "blouse=" + data[rowIndex].blouse;
            rowDress = "dress=" + data[rowIndex].dress;
            rowSkirt = "skirt=" + data[rowIndex].skirt;
            rowPants = "pants=" + data[rowIndex].pants;
            rowJacket = "jacket=" + data[rowIndex].jacket;
            rowTie = "tie=" + data[rowIndex].tie;
            rowVest = "vest=" + data[rowIndex].vest;
            rowGlasses = "glasses=" + data[rowIndex].glasses;
            rowShoes = "shoes=" + data[rowIndex].shoes;
            rowTattoos = "tatoo=" + data[rowIndex].tattoos;
            rowScars = "scar=" + data[rowIndex].scars;
            rowHat = "hat=" + data[rowIndex].hat;
            rowEarrings = "earings=" + data[rowIndex].earrings;
            rowMakeup = "makeup=" + data[rowIndex].makeup;


            // pass parameters into current parent URL to be transferred into iframe URL
            var parameterArray = [rowGender, rowComplexion, rowEyeColour, rowHair, rowHairColour, rowFacialHair, rowShirt, rowBlouse, rowDress, rowJacket, rowSkirt, rowPants, rowTie, rowVest, rowShoes, rowMakeup, rowScars, rowTattoos, rowGlasses, rowHat, rowEarrings];

            // remove commas from array and replace with & instead through the join() method
            parameterArray = parameterArray.join('&');




            var mainUrl = "https://aoibheannamy.github.io/getCharacterAvatar/charactercreator.html/";
            //var urlParams = new URLSearchParams(window.location.search);
            urlParams = parameterArray.toString();
            var ref = document.URL;

            var iframeUrl = mainUrl + '#' + urlParams;
            console.log(iframeUrl);
            document.getElementById('myiframe').src = iframeUrl;
        }
        /**
        * This function clears the iframe src so that another selection can be made.
        */
        function clearAvatar() {
            document.getElementById('myiframe').src = "";
        }




    </script>


</body>

</html>