<!DOCTYPE HTML>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Character Avatar Representation</title>
    <link href="https://unpkg.com/tabulator-tables@4.6.3/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.6.3/dist/js/tabulator.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.0.5/jspdf.plugin.autotable.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
    <script type="text/javascript" src="CharactersLabelledDetailsBest.json"></script>
</head>

<body>

    <!--Create iframe container -->
    <div class="embed-responsive embed-responsive-16by9"
        style="border: 1px solid rgba(0,0,0,.1); border-radius: 0.25rem; min-height: 400px;">
        <iframe id="myiframe" class="embed-responsive-item" src="" style="width: 100%; height: 400px;">
        </iframe>
    </div>


    <!--Create div for the tabulator table-->
    <div id="example-table" style="width: 90%; margin-bottom: 30px;"></div>
    <!--Create buttons for interactivity between table and iframe-->
    <button type="button" class="btn btn-info" id="generateAvatar" onclick="generateAvatar()">Generate Character
        Avatar!</button>
    <button type="button" class="btn btn-info" id="clearAvatar" onclick="clearAvatar()">Clear Character Avatar
        Selection!</button>


    <script type="text/javascript">
        //create table to hold the character appearances that were labelled via Amazon's mechanical Turk
        var local_data = charDetails;
        var rowIndex;
        console.log("table data: " + local_data);
        var table = new Tabulator("#example-table", {
            index: "numberOfCharacters",
            data: local_data,
            placeholder: "No Data Available",
            columns: [
                { title: "Character", field: "numberOfCharacters", editor: "input" },
                { title: "Name", field: "names", editor: "input" },
                { title: "Blouse", field: "blouse", editor: "input", },
                { title: "Complexion", field: "complexion", editor: "input",  },
                { title: "Dress", field: "dress", editor: "input",  },
                { title: "Earrings", field: "earrings", hozAlign: "center", editor: "input", },
                { title: "Eye Colour", field: "eyeColour", editor: "input", },
                { title: "Facial Hair", field: "facialHair", editor: "input",  },
                { title: "Gender", field: "gender", editor: "input", },
                { title: "Glasses", field: "glasses", hozAlign: "right", editor: "input", },
                { title: "Hair Style", field: "hair", editor: "input",  },
                { title: "Hair Colour", field: "hairColour", editor: "input", },
                { title: "Hat", field: "hat", hozAlign: "center", editor: "input", },
                { title: "Jacket", field: "jacket", editor: "input", },
                { title: "Makeup", field: "makeup", hozAlign: "center", editor: "input",  },
                { title: "Trousers", field: "pants", editor: "input",  },
                { title: "Scars", field: "scars", hozAlign: "center", editor: "input", },
                { title: "Shirt", field: "shirt", editor: "input",  },
                { title: "Shoes", field: "shoes", editor: "input",  },
                { title: "Skirt", field: "skirt", editor: "input",  },
                { title: "Tattoos", field: "tattoos", hozAlign: "center", editor: "input", },
                { title: "Tie", field: "tie", editor: "input",  },
                { title: "Vest", field: "vest", editor: "input", },
            ],

            // this function accesses the row which has been selected, or clicked

            rowClick: function (e, row) {
                // get index of row selected
                rowIndex = row.getIndex();
                // print index to console
                console.log("Row index: " + rowIndex);
                // get data for the selected row
                var rowData = row.getData();
                // print row data to console
                console.log(rowData);

            }


        });
        // replace data 
        table.replaceData(local_data);

        // generate onclick functions for buttons
        document.getElementById("generateAvatar").onclick = function () { generateAvatar() };
        document.getElementById("clearAvatar").onclick = function () { clearAvatar() };

        /**
         * This function will, when the Generate Avatar button is clicked, reload the iframe to include the parameters 
        */
        function generateAvatar() {
            myTable = Tabulator.prototype.findTable('#example-table')[0];
            var data = myTable.getData();
            // get the parameters
            // split up row data into separate variables
            // the following variables should always have a value
            // need to add the prefixes before so that charactercreator.org can read them correctly!!
            // declare variables for row variables
            var rowGender, rowComplexion, rowEyeColour, rowHair, rowHairColour, rowFacialHair, rowShirt, rowBlouse, rowDress, rowJacket, rowSkirt, rowPants, rowTie, rowVest, rowShoes, rowMakeup, rowScars, rowTattoos, rowGlasses, rowHat, rowEarrings;
            rowGender = "sex=" + data[rowIndex].gender;
            rowComplexion = "skinColor=" + data[rowIndex].complexion;
            rowEyeColour = "irisColor=" + data[rowIndex].eyeColour;
            rowHair = "hair=" + data[rowIndex].hair;
            rowHairColour = "hairColor=" + data[rowIndex].hairColour;

            // these variables are optional, so need the check the value is not null before setting to the corresponding variable

            rowFacialHair = "facialhair=" + data[rowIndex].facialHair;
            rowShirt = "shirt=" + data[rowIndex].shirt;
            rowBlouse = "blouse=" + data[rowIndex].blouse;
            rowDress = "dress=" + data[rowIndex].dress;
            rowSkirt = "skirt=" + data[rowIndex].skirt;
            rowPants = "pants=" + data[rowIndex].pants;
            rowJacket = "jacket=" + data[rowIndex].jacket;
            rowTie = "tie=" + data[rowIndex].tie;
            rowVest = "vest=" + data[rowIndex].vest;
            rowGlasses = "glasses=" + data[rowIndex].glasses;
            rowShoes = "shoes=" + data[rowIndex].shoes;
            rowTattoos = "tatoo=" + data[rowIndex].tattoos;
            rowScars = "scar=" + data[rowIndex].scars;
            rowHat = "hat=" + data[rowIndex].hat;
            rowEarrings = "earings=" + data[rowIndex].earrings;
            rowMakeup = "makeup=" + data[rowIndex].makeup;


            // pass parameters into current parent URL to be transferred into iframe URL
            var parameterArray = [rowGender, rowComplexion, rowEyeColour, rowHair, rowHairColour, rowFacialHair, rowShirt, rowBlouse, rowDress, rowJacket, rowSkirt, rowPants, rowTie, rowVest, rowShoes, rowMakeup, rowScars, rowTattoos, rowGlasses, rowHat, rowEarrings];

            // remove commas from array and replace with & instead through the join() method
            parameterArray = parameterArray.join('&');




            var mainUrl = "https://aoibheannamy.github.io/getCharacterAvatar/charactercreator.html/";
            //var urlParams = new URLSearchParams(window.location.search);
            urlParams = parameterArray.toString();
            var ref = document.URL;

            var iframeUrl = mainUrl + '#' + urlParams;
            console.log(iframeUrl);
            document.getElementById('myiframe').src = iframeUrl;
        }
        /**
        * This function clears the iframe src so that another selection can be made.
        */
        function clearAvatar() {
            document.getElementById('myiframe').src = "";
        }




    </script>


</body>

</html>