<!DOCTYPE HTML>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Novel</title>
    <link href="https://unpkg.com/tabulator-tables@4.6.3/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.6.3/dist/js/tabulator.min.js"></script>
    <script type="text/javascript" src="../turkResults/CharactersLabelledDetailsBest.json"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
</head>

<body>

    <div class="embed-responsive embed-responsive-16by9"
        style="border: 1px solid rgba(0,0,0,.1); border-radius: 0.25rem; min-height: 400px;">
        <iframe id="myiframe" class="embed-responsive-item" src="https://charactercreator.org/"
            style="width: 100%; height: 400px;">
        </iframe>
    </div>



    <div id="example-table" style="width: 90%; margin-bottom: 30px;"></div>

    <button type="button" class="btn btn-info" id="generateAvatar">Generate Character Avatar!</button>


    <script type="text/javascript">
        //create table to hold the character appearances that were labelled via Amazon's mechanical Turk
        var local_data = charDetails;
        var table = new Tabulator("#example-table", {
            index: "numberOfCharacters",
            selectable: 1,
            pagination: "local",
            data: local_data,
            paginationSize: 13,
            layout: "fitColumns",
            placeholder: "No Data Available",
            columns: [
                { title: "Character", field: "numberOfCharacters", editor: "input" },
                { title: "Name", field: "Names", editor: "input" },
                { title: "Gender", field: "gender", editor: "input" },
                { title: "Complexion", field: "complexion", editor: "input" },
                { title: "Eye Colour", field: "eyeColour", editor: "input" },
                { title: "Hair Colour", field: "hairColour", editor: "input" },
                { title: "Hair Style", field: "hair", editor: "input" },
                { title: "Facial Hair", field: "facialHair", editor: "input" },
                { title: "Shirt", field: "shirt", editor: "input" },
                { title: "Blouse", field: "blouse", editor: "input" },
                { title: "Dress", field: "dress", editor: "input" },
                { title: "Tie", field: "tie", editor: "input" },
                { title: "Vest", field: "vest", editor: "input" },
                { title: "Jacket", field: "jacket", editor: "input" },
                { title: "Trousers", field: "pants", editor: "input" },
                { title: "Skirt", field: "skirt", editor: "input" },
                { title: "Shoes", field: "shoes", editor: "input" },
                {
                    title: "Distinctive Features", //create column group
                    columns: [
                        { title: "Glasses", field: "glasses", hozAlign: "right" },
                        { title: "Hat", field: "hat", hozAlign: "center" },
                        { title: "Earrings", field: "earrings", hozAlign: "center", },
                        { title: "Makeup", field: "makeup", hozAlign: "center", },
                        { title: "Tattoos", field: "tattoos", hozAlign: "center", },
                        { title: "Scars", field: "scars", hozAlign: "center", },
                    ],
                },

            ],
            // this function accesses the row which has been selected, or clicked

            rowClick: function (e, row) {
                // declare variables for row variables
                var rowGender, rowComplexion, rowEyeColour, rowHair, rowHairColour, rowFacialHair, rowShirt, rowBlouse, rowDress, rowJacket, rowSkirt, rowPants, rowTie, rowVest, rowShoes, rowMakeup, rowScars, rowTattoos, rowGlasses, rowHat, rowEarrings;
                // get index of row selected
                rowIndex = row.getIndex();
                // print index to console
                console.log("Row index: " + rowIndex);
                // get data for the selected row
                var rowData = row.getData();
                // print row data to console
                console.log(rowData);

                // split up row data into separate variables
                // the following variables should always have a value
                // need to add the prefixes before so that charactercreator.org can read them correctly!!
                rowGender = "sex=" + row.getData().gender;
                rowComplexion = "skinColor=" + row.getData().complexion;
                rowEyeColour = "irisColor=" + row.getData().eyeColour;
                rowHair = "hair=" + row.getData().hair;
                rowHairColour = "hairColor=" + row.getData().hairColour;

                // these variables are optional, so need the check the value is not null before setting to the corresponding variable
                
                    rowFacialHair = "facialhair=" + row.getData().facialHair;
                    rowShirt = "shirt=" + row.getData().shirt;
                    rowBlouse = "blouse=" + row.getData().blouse;
                    rowDress = "dress=" + row.getData().dress;
                    rowSkirt = "skirt=" + row.getData().skirt;
                    rowPants = "pants=" + row.getData().pants;
                    rowJacket = "jacket=" + row.getData().jacket;
                    rowTie = "tie=" + row.getData().tie;
                    rowVest = "vest=" + row.getData().vest;
                    rowGlasses = "glasses=" + row.getData().glasses;
                    rowShoes = "shoes=" + row.getData().shoes;
                    rowTattoos = "tatoo=" + row.getData().tattoos;
                    rowScars = "scar=" + row.getData().scars;
                    rowHat = "hat=" + row.getData().hat;
                    rowEarrings = "earings=" + row.getData().earrings;
                    rowMakeup = "makeup=" + row.getData().makeup;
                

                // pass parameters into current parent URL to be transferred into iframe URL
                var parameterArray = [rowGender, rowComplexion, rowEyeColour, rowHair, rowHairColour, rowFacialHair, rowShirt, rowBlouse, rowDress, rowJacket, rowSkirt, rowPants, rowTie, rowVest, rowShoes, rowMakeup, rowScars, rowTattoos, rowGlasses, rowHat, rowEarrings];

                // remove commas from array and replace with & instead through the join() method
                parameterArray = parameterArray.join('&');			



                document.getElementById("generateAvatar").onclick = function () { generateAvatar() };


                /**
                 * This function will, when the Generate Avatar button is clicked, reload the iframe to include the parameters 
                 */
                function generateAvatar() {
                    var iframeSrc = document.getElementById('myiframe');
                    //var urlParams = new URLSearchParams(window.location.search);
                    urlParams = parameterArray.toString();
                    var ref = document.URL;

                    var iframeUrl = iframeSrc + '#' + urlParams ;
                    console.log(iframeUrl);
                    //Modify the src attribute of the iframe with the ID "myiframe"

                    iframeSrc.src= iframeUrl;
                    console.log(iframeSrc);
                }

            }


        });
        for (var loop = 1; loop < 10; loop++) {
            table.addRow({ numberOfCharacters: loop }, false);
        }


    </script>


</body>

</html>